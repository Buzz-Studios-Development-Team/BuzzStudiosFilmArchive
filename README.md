# The Buzz Studios Film Archive

## Introduction
The Buzz Studios Film Archive is the centralized film viewing service for the Buzz Studios Filmmaking Club, the predominant filmmaking organization at the Georgia Institute of Technology. The Archive was created in 2023 to address a glaring lack of centralization for the club's work, making it difficult for members to view the films they had themselves worked on and for prospective members to get a sense of the club's work prior to joining. It is therefore of the utmost importance that this website continue to be maintained in the forthcoming years. This README has been designed with the intention of making the development of this website as accessible as possible for future members of Buzz Studios, under the supervision of the Historical Manager. For any questions regarding the initial development of the Archive, reach out to Ethan Ollins, the 2023-2024 president and initial developer of this site, at ethanollins6@gmail.com or (310) 909-6172.

## Development History and Structure
The Buzz Studios Film Archive makes use of a React-based frontend and interfaces with a backend provided by Google Cloud services, with the frontend hosted on Google's Firebase service. The Buzz Studios email account, gatechbuzzstudios@gmail.com, has been granted admin access to the entirety of the project, which will allow future site developers to access the existing system. If the club email were ever to change, the aforementioned address should be preserved for development purposes. The Archive initially served film information through a local JSON file, which made it cumbersome to change details or add new films. To address this, an admin system was added in July 2023, and the film information was moved to Google Firestore, a no-SQL database service.

### Content Delivery
Films are served to the watch page on the Archive website through Google Cloud Storage, where all film files are stored. Security rules on the storage bucket have prevented direct access without authorization. Film files are served through a content delivery network (CDN) hosted on Google Cloud, which accounts for the majority of the server costs. This approach has the benefit of increased security potential and the reduction of per-gigabyte bandwidth costs, which add up very quickly when files are streamed directly from their storage buckets. The CDN provides the added benefit of caching film files. Films must be accessed by requesting a signed URL. This process is detailed below.

#### How signed URLs work
Signed URLs make use of a public and private key verification system. The Cloud CDN service includes an access setting that requires the presence of a valid public key to access a film file. Within the Cloud CDN service, one can generate a private key that will be used to verify incoming requests. When a signed URL is generated, assuming that prior authentication of the user's access to the requested film has taken place, the full request URL, which includes GET parameters for the expiration date of the signed URL and the name of the private key, is hashed using the private key. The resulting signature, encoded in Base64, is provided as an additional GET parameter in the finished URL. If the signed URL is valid, the film is accessible. If not, a 403 (Forbidden) status code results instead.

#### How the Film Archive verifies requests
The vast majority of the films shown on the Archive are publicly accessible, making strict security largely unnecessary. However, a limited selection of films at any given time will be subject to access restriction, which is usually due to the film being unfinished or currently in contention for film festivals, which occassionally require submissions to not be publicly accessible prior to potentially premiering at the festival. Films with this restriction make use of an access code, which differs between films and is chosen when the film is uploaded to the archive and can be changed at any time.

When a user clicks on a film thumbnail on the website, a request for an anonymous authentication is made to Google Firebase's provided authentication service. Once this handler returns a successful status code, the website makes an HTTP POST request to the request-film endpoint, which is hosted on Google's Cloud Functions service. If the film is publicly viewable, only the name of the film's video file is provided as a parameter -- if it is access-restricted, the access code entered by the user is provided as well. If access verification is necessary, the cloud function verifies the provided code against the hash stored in the Firestore database under the given film's registry. Assuming successful verification has taken place, a signed URL valid for five minutes is generated and included in the response body. A failed request will return the 403 status code.

The script run by the cloud function is written in Python and makes use of several cryptographic libraries for verifying the provided access code and properly hashing the public URL key. The private key is provided as an environment variable to this cloud function. It is therefore of utmost importance that the expiration date of the private key be noted and a new one created prior to expiration. This key should subsequently be added to the function's environment variables under the identifier 'key,' along with the name of the key under 'keyName.' It is helpful to name the key after its intended duration of use so that it can be properly refreshed when the time comes. If this key expires, no films will be accessible.

### Storage and Access of Film Details
All data accessed by the Buzz Studios Film Archive is stored in the Google Firestore database. This database primarily contains film records, but is also used for granting admin access to member of the Exec Team. Additionally, records of change requests to film details made by non-Exec club members are stored here. Google Firestore is organized into three categories -- collections ('films,' 'users,' and 'requests'), documents ('geiger,' 'continuous,' and 'canned'), and fields (title, director, synopsis, etc). 

#### Films collection
All film records are stored in this collection in distinct documents identified by a film ID, which is typically a one-word title (often abbreviated), such as 'geiger,' 'fbltid,' or 'instoppdisorder.' Each document contains all information made available to the end user when visiting that film's watch page, as well as the file names of the video and thumbnail. These documents additionally store the access restriction status of the film, for which there are three options ('released', 'restricted', and 'unavailable'), and, if applicable, a hashed access code. All of these fields are considered public information. The HomePage component of the archive site queries this collection and a JavaScript functions organizes them into chronological semester order, with the order of films within a given semester dictated by the film record's 'order' field. Films should be listed in the order of production, starting from the beginning of the semester, with simultaneous mini-projects listed in their order of completion or release.

Once the watch page for a given film is accessed, its film ID is used to request the full slate of film details, which will be used to populate the watch page's information on the film and request a signed video URL. The film ID is therefore the most important identifier for film data.

The 'authorized' field for each film dictates who outside of the Exec Team, which has access to all film records, is allowed to log into the admin console and make detail update requests for the given film. This privilege should be restricted to the director of that film, as well as any writers or producers who may have collaborated.

#### Users collection
The users collection is used to grant Exec-level access to the admin console, which will be discussed in a later section. Whoever is maintaining the website at any given time should ensure that a record exists for all members of the Exec Team with their preferred email address present. Logins are verified not through user accounts but by sending one-time links to user email addresses, and the presence of a user record with the 'exec' field set to true will decide whether that user can access Exec-level controls. Dedicated user records do not need to be created in the users collection for non-Exec members, as their authorization takes place in the film records.

#### Requests collection
When a non-Exec member enters a detail change request, all of their requested updates are inserted into the requests collection. These requests are accessible through the Exec-level admin console, and details can be further revised, confirmed, or denied by a verified member of the Exec Team. Once a request has been acknowledged and completed, its details are erased and replaced with a 'closed' flag.

### The Admin Console
The admin console is the chief avenue for adding, removing, and revising film records through the frontend. It can be accessed through the /admin route. Logins to the admin console take place through account-less authentication by sending one-time codes to email addresses entered into the field. Anybody can access the admin console this way, but only films authorized to that specific user will be populated in the 'My Films' list. Non-Exec members can choose between their authorized films and submit change requests for a limited selection of film details as well as upload revised video files and thumbnail files. Exec Team members can access a menu to add a new film, edit any present film, and review any submitted request.

#### Uploading film and thumbnail files
The admin console flows through several stages. The first upon choosing a film to act on is a menu for entering and changing all text-based details of a film. The second is a menu that allows the user to upload a new film file. This file is uploaded directly to the main storage bucket and named by the film ID and the Unix timestamp of the upload time, allowing for successive revisions to be differentiated. File uploads by Exec users will supersede the present file immediately upon update confirmation, while non-Exec uploads will require Exec approval. When a film or thumbnail file revision is conducted, the 'filmfile' and 'thumbnail' fields of the given film record are updated to the new file name. This is the mechanism by which films are connected to their video and thumbnail files. The previous versions will linger in the storage bucket, so if data storage costs add up, it will be helpful to remove revisions that are no longer needed.

The non-Exec version of the file uploader will allow the user to either upload a new file or preserve the current one, while the Exec version will introduce the additional option of 'File Name Override.' This is helpful if a file whose name is known is already present in the storage bucket but is not associated with the film record. This can help reduce the necessity of uploading files that are already present.

## Maintenance
It is of utmost importance that this archive be diligently maintained throughout the forthcoming years and beyond. For a club with such a long and storied history, it is unfortunate that many of its productions from the 2000s and 2010s are not currently known to its current members in 2023. All films produced by Buzz Studios should be added as soon as they are completed, and their directors and producers should be made fully aware of their control over the details of their film on the website. For films with access restrictions, the Historical Manager should set out a clear timeline for when public release can be granted based on festival submission timelines, especially if that member is poised to graduate. Films displayed on the website should always be in their most recent available form.

### Summary of website structure
Below is a summary of the overall structure of the Buzz Studios Film Archive.

* ReactJS frontend service, deployed to Google Firebase. (films.buzzstudios.org)
* Admin console service. (films.buzzstudios.org/admin)
* Google Cloud Storage, where all film files and thumbnail files are kept.
* Google Cloud CDN service, which regulates access to films. (cdn.buzzstudios.org)
* Google Firestore, where all film records and user access records are stored.
* Google Cloud Functions, which holds the access verification and URL-signing script. (Ensure that the latest Cloud CDN keys are always present here!)
* Google Authentication, which regulates access to the admin console.

### Making front-end modifications
Navigate to the root directory and run ```npm run build```. Subsequently, run ```firebase deploy```.